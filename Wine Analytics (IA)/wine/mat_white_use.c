#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <conio.h>

int main()
{
    float E1;
    float E2;
    float E3;
    float E4;
    float E5;
    float E6;
    float E7;
    float E8;
    float E9;
    float E10;
    float E11;
    float E12;

    float w1[13][13];
    float w2[13][13];
    float I[13][13];
    float O[13][13];
    int i = 0, j, l;
    float output;

    //------------------READ W's-----------------------------
    w1[0][0] = -1.940398;
    w1[1][0] = 0.301121;
    w1[2][0] = -1.350568;
    w1[3][0] = 0.751424;
    w1[4][0] = 0.304583;
    w1[5][0] = -0.304766;
    w1[6][0] = -0.539648;
    w1[7][0] = 0.221192;
    w1[8][0] = 1.182841;
    w1[9][0] = 0.704759;
    w1[10][0] = -0.992094;
    w1[11][0] = 5.204983;
    w1[12][0] = -1.403912;
    w1[0][1] = 0.339125;
    w1[1][1] = -0.489635;
    w1[2][1] = -1.560631;
    w1[3][1] = -1.242309;
    w1[4][1] = -0.455108;
    w1[5][1] = -0.940145;
    w1[6][1] = -0.837033;
    w1[7][1] = 2.037363;
    w1[8][1] = 0.251432;
    w1[9][1] = -1.052325;
    w1[10][1] = -1.412131;
    w1[11][1] = -2.872302;
    w1[12][1] = 1.508578;
    w1[0][2] = -0.011628;
    w1[1][2] = 0.175407;
    w1[2][2] = -0.066237;
    w1[3][2] = -0.010695;
    w1[4][2] = -1.144244;
    w1[5][2] = 0.258303;
    w1[6][2] = 0.288886;
    w1[7][2] = 0.080199;
    w1[8][2] = -0.694461;
    w1[9][2] = 0.351068;
    w1[10][2] = 0.696589;
    w1[11][2] = 10.471610;
    w1[12][2] = -4.435998;
    w1[0][3] = -0.792199;
    w1[1][3] = 1.503891;
    w1[2][3] = 0.906705;
    w1[3][3] = 1.823603;
    w1[4][3] = 1.702872;
    w1[5][3] = 0.157414;
    w1[6][3] = -1.430647;
    w1[7][3] = -0.151677;
    w1[8][3] = -1.058687;
    w1[9][3] = 1.448958;
    w1[10][3] = -1.161595;
    w1[11][3] = 1.118625;
    w1[12][3] = 1.374615;
    w1[0][4] = 2.265566;
    w1[1][4] = 2.082517;
    w1[2][4] = 0.719328;
    w1[3][4] = -0.057302;
    w1[4][4] = -0.809027;
    w1[5][4] = -0.536746;
    w1[6][4] = 1.462902;
    w1[7][4] = -1.107332;
    w1[8][4] = -0.183998;
    w1[9][4] = -1.219194;
    w1[10][4] = 0.964169;
    w1[11][4] = -3.956718;
    w1[12][4] = 0.426952;
    w1[0][5] = 1.074077;
    w1[1][5] = -1.231264;
    w1[2][5] = -0.991955;
    w1[3][5] = 0.261422;
    w1[4][5] = 0.478611;
    w1[5][5] = 1.107620;
    w1[6][5] = -0.041970;
    w1[7][5] = -0.185057;
    w1[8][5] = -1.779227;
    w1[9][5] = 0.556427;
    w1[10][5] = -0.443913;
    w1[11][5] = -5.798708;
    w1[12][5] = 2.884645;
    w1[0][6] = 0.846078;
    w1[1][6] = -1.275622;
    w1[2][6] = 0.042932;
    w1[3][6] = -0.622942;
    w1[4][6] = 0.881352;
    w1[5][6] = 0.129006;
    w1[6][6] = 0.584150;
    w1[7][6] = -0.085380;
    w1[8][6] = -0.608027;
    w1[9][6] = -0.875028;
    w1[10][6] = 0.004975;
    w1[11][6] = 7.551445;
    w1[12][6] = -2.612830;
    w1[0][7] = 2.075577;
    w1[1][7] = 0.960603;
    w1[2][7] = -0.593774;
    w1[3][7] = -1.288826;
    w1[4][7] = 0.597621;
    w1[5][7] = 0.048697;
    w1[6][7] = -1.619869;
    w1[7][7] = 0.723532;
    w1[8][7] = 0.338776;
    w1[9][7] = -1.187965;
    w1[10][7] = 2.249760;
    w1[11][7] = -0.290064;
    w1[12][7] = 1.961913;
    w1[0][8] = 0.560196;
    w1[1][8] = -0.997570;
    w1[2][8] = -0.357123;
    w1[3][8] = -1.735664;
    w1[4][8] = 1.745199;
    w1[5][8] = 0.675871;
    w1[6][8] = -1.733553;
    w1[7][8] = 0.861603;
    w1[8][8] = 1.004996;
    w1[9][8] = 0.171278;
    w1[10][8] = -1.112745;
    w1[11][8] = -2.586354;
    w1[12][8] = 1.473956;
    w1[0][9] = -0.148533;
    w1[1][9] = -1.399245;
    w1[2][9] = 0.115163;
    w1[3][9] = 1.028039;
    w1[4][9] = -0.415789;
    w1[5][9] = -0.716929;
    w1[6][9] = 0.113122;
    w1[7][9] = 0.342716;
    w1[8][9] = 0.840496;
    w1[9][9] = 0.875597;
    w1[10][9] = 0.058082;
    w1[11][9] = -3.766065;
    w1[12][9] = 0.762631;
    w1[0][10] = 1.250754;
    w1[1][10] = -1.919753;
    w1[2][10] = 0.014743;
    w1[3][10] = 0.605601;
    w1[4][10] = -0.352005;
    w1[5][10] = -1.600048;
    w1[6][10] = 1.750282;
    w1[7][10] = 1.629505;
    w1[8][10] = 0.221311;
    w1[9][10] = -0.630146;
    w1[10][10] = 0.001941;
    w1[11][10] = 0.000297;
    w1[12][10] = 1.086997;
    w1[0][11] = -0.995455;
    w1[1][11] = -0.449686;
    w1[2][11] = -0.992357;
    w1[3][11] = 1.777786;
    w1[4][11] = -0.911617;
    w1[5][11] = 0.771251;
    w1[6][11] = -0.325724;
    w1[7][11] = -1.013144;
    w1[8][11] = 0.348277;
    w1[9][11] = 1.049747;
    w1[10][11] = -0.881113;
    w1[11][11] = -3.061474;
    w1[12][11] = 1.607764;
    w1[0][12] = -1.477573;
    w1[1][12] = 1.885625;
    w1[2][12] = 0.709959;
    w1[3][12] = -0.948571;
    w1[4][12] = 0.207193;
    w1[5][12] = -0.652091;
    w1[6][12] = 1.536259;
    w1[7][12] = 0.279897;
    w1[8][12] = 0.422135;
    w1[9][12] = -0.761568;
    w1[10][12] = 1.092650;
    w1[11][12] = -6.440594;
    w1[12][12] = 1.780386;
    w2[0][0] = 5.268840;
    w2[1][0] = -2.946934;
    w2[2][0] = 11.670622;
    w2[3][0] = -0.994579;
    w2[4][0] = -3.621818;
    w2[5][0] = -6.523274;
    w2[6][0] = 7.802576;
    w2[7][0] = 0.553423;
    w2[8][0] = -2.420166;
    w2[9][0] = -3.632899;
    w2[10][0] = 0.655198;
    w2[11][0] = -3.394087;
    w2[12][0] = -6.379789;
    w2[0][1] = -3.388869;
    w2[1][1] = -2.000000;
    w2[2][1] = 0.132883;
    w2[3][1] = -0.008801;
    w2[4][1] = -1.770698;
    w2[5][1] = -2.723492;
    w2[6][1] = -0.819453;
    w2[7][1] = -3.560397;
    w2[8][1] = -2.668233;
    w2[9][1] = -0.635563;
    w2[10][1] = -0.108026;
    w2[11][1] = -0.131494;
    w2[12][1] = -0.155943;

    //-----propagation----------------------------

    FILE *in;

    if ((in = fopen("C:\\Wine\\outputs\\wine.txt", "rt")) == NULL)
    {
        printf("Unable to open file.\n");
        return 1;
    }

    while (!feof(in))
    {
        fscanf(in, "%f;%f;%f;%f;%f;%f;%f;%f;%f;%f;%f", &E1, &E2, &E3, &E4, &E5, &E6, &E7, &E8, &E9, &E10, &E11);

        i++;
    }

    printf("====== ANALISE VINHO BRANCO ======\n\n");

    printf("\n Acidez fixa -------------- %.2f", E1);
    printf("\n Acidez volatil ----------- %.2f", E2);
    printf("\n Acidez citrica ----------- %.2f", E3);
    printf("\n Acucar resitual ---------- %.2f", E4);
    printf("\n Cloretos ----------------- %.2f", E5);
    printf("\n Dioxido enxofre livre ---- %.2f", E6);
    printf("\n Dioxido enxofre total ---- %.2f", E7);
    printf("\n Densidade ---------------- %.2f", E8);
    printf("\n pH ----------------------- %.2f", E9);
    printf("\n Sulfatos ----------------- %.2f", E10);
    printf("\n Alcool ------------------- %.2f", E11);

    printf("\n\n Pressione a tecla Enter para iniciar a analise... \n\n");

    fclose(in);
    getch();

    E1 = (E1 - 3.8) / 10.4;
    E2 = (E2 - 0.08) / 1.02;
    E3 = (E3 - 0) / 1.66;
    E4 = (E4 - 0.6) / 31;
    E5 = (E5 - 0.01) / 0.34;
    E6 = (E6 - 2) / 144;
    E7 = (E7 - 9) / 357.5;
    E8 = (E8 - 0.99) / 0.01;
    E9 = (E9 - 2.72) / 1.1;
    E10 = (E10 - 0.22) / 0.86;
    E11 = (E11 - 8) / 6.2;
    E12 = (E12 - 3) / 6;

    I[0][0] = E1;
    I[0][1] = E2;
    I[0][2] = E3;
    I[0][3] = E4;
    I[0][4] = E5;
    I[0][5] = E6;
    I[0][6] = E7;
    I[0][7] = E8;
    I[0][8] = E9;
    I[0][9] = E10;
    I[0][10] = E11;
    I[0][11] = E12;
    I[0][12] = 1.0;

    O[0][0] = I[0][0];
    O[0][1] = I[0][1];
    O[0][2] = I[0][2];
    O[0][3] = I[0][3];
    O[0][4] = I[0][4];
    O[0][5] = I[0][5];
    O[0][6] = I[0][6];
    O[0][7] = I[0][7];
    O[0][8] = I[0][8];
    O[0][9] = I[0][9];
    O[0][10] = I[0][10];
    O[0][11] = I[0][11];
    O[0][12] = I[0][12];

    for (j = 0; j < 13; j++)
    {
        I[1][j] = 0.0;
        for (i = 0; i < 13; i++)
        {
            I[1][j] += w1[i][j] * O[0][i];
        }
        O[1][j] = 1.0 / (1.0 + exp(-I[1][j]));
    }

    I[1][3] = 1.0;
    O[1][3] = I[1][3];

    for (l = 0; l < 2; l++)
    {
        I[2][l] = 0.0;
        for (j = 0; j < 13; j++)
        {
            I[2][l] += w2[j][l] * O[1][j];
        }
        O[2][l] = 1.0 / (1.0 + exp(-I[2][l]));
        //printf(" %.2f\n", O[2][l]);
        output = O[2][l];
    }

    //gravar resultado em arquivo txt
    FILE *pont_arq;
    pont_arq = fopen("C:\\Wine\\outputs\\quality.txt", "w");

    if (pont_arq == NULL)
    {
        printf("There was an error saving the data..");
        return 1;
    }

    fprintf(pont_arq, "%.2f", output);

    fclose(pont_arq);

    printf("\n\nTraining completed.\n");
    system("pause");
    //-----backpropagation----------------------
}
