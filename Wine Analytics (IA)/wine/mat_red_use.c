#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <conio.h>

int main()
{
    float E1;
    float E2;
    float E3;
    float E4;
    float E5;
    float E6;
    float E7;
    float E8;
    float E9;
    float E10;
    float E11;
    float E12;

    float w1[13][13];
    float w2[13][13];
    float I[13][13];
    float O[13][13];
    int i = 0, j, l;
    float output;

    //------------------READ W's-----------------------------
    w1[0][0] = -2.100363;
    w1[1][0] = -0.020518;
    w1[2][0] = -1.175881;
    w1[3][0] = 1.044763;
    w1[4][0] = 0.216544;
    w1[5][0] = -0.321894;
    w1[6][0] = -0.502630;
    w1[7][0] = 0.669315;
    w1[8][0] = 0.942192;
    w1[9][0] = 0.899380;
    w1[10][0] = -1.357016;
    w1[11][0] = 3.393863;
    w1[12][0] = -0.947141;
    w1[0][1] = 0.397743;
    w1[1][1] = -0.741321;
    w1[2][1] = -1.114111;
    w1[3][1] = -1.354066;
    w1[4][1] = -0.320222;
    w1[5][1] = -0.935314;
    w1[6][1] = -1.004487;
    w1[7][1] = 2.494237;
    w1[8][1] = -0.113884;
    w1[9][1] = -1.263835;
    w1[10][1] = -1.547549;
    w1[11][1] = -4.563665;
    w1[12][1] = 1.313304;
    w1[0][2] = -0.384190;
    w1[1][2] = 0.156431;
    w1[2][2] = -0.165786;
    w1[3][2] = 0.148933;
    w1[4][2] = -1.383392;
    w1[5][2] = 0.100862;
    w1[6][2] = -0.013653;
    w1[7][2] = 0.009859;
    w1[8][2] = -1.505133;
    w1[9][2] = 0.473761;
    w1[10][2] = 0.988381;
    w1[11][2] = 7.870173;
    w1[12][2] = -3.202741;
    w1[0][3] = -0.792199;
    w1[1][3] = 1.503891;
    w1[2][3] = 0.906705;
    w1[3][3] = 1.823603;
    w1[4][3] = 1.702872;
    w1[5][3] = 0.157414;
    w1[6][3] = -1.430647;
    w1[7][3] = -0.151677;
    w1[8][3] = -1.058687;
    w1[9][3] = 1.448958;
    w1[10][3] = -1.161595;
    w1[11][3] = 1.118625;
    w1[12][3] = 1.374615;
    w1[0][4] = 2.270122;
    w1[1][4] = 2.265778;
    w1[2][4] = 0.515118;
    w1[3][4] = -0.230622;
    w1[4][4] = -0.842569;
    w1[5][4] = -0.581823;
    w1[6][4] = 1.356138;
    w1[7][4] = -1.493396;
    w1[8][4] = -0.101525;
    w1[9][4] = -1.574253;
    w1[10][4] = 0.989839;
    w1[11][4] = -2.347440;
    w1[12][4] = -0.574978;
    w1[0][5] = 1.366934;
    w1[1][5] = -0.948549;
    w1[2][5] = -0.947799;
    w1[3][5] = 0.361329;
    w1[4][5] = 0.665038;
    w1[5][5] = 1.165766;
    w1[6][5] = 0.220428;
    w1[7][5] = -0.524504;
    w1[8][5] = -1.362910;
    w1[9][5] = 0.642127;
    w1[10][5] = -0.330419;
    w1[11][5] = -4.819142;
    w1[12][5] = 2.862483;
    w1[0][6] = 0.674028;
    w1[1][6] = -1.413289;
    w1[2][6] = 0.002564;
    w1[3][6] = -0.568678;
    w1[4][6] = 0.837367;
    w1[5][6] = 0.238753;
    w1[6][6] = 0.483686;
    w1[7][6] = -0.179443;
    w1[8][6] = -0.955465;
    w1[9][6] = -1.060733;
    w1[10][6] = -0.057233;
    w1[11][6] = 4.819082;
    w1[12][6] = -1.346716;
    w1[0][7] = 2.021994;
    w1[1][7] = 1.018689;
    w1[2][7] = -0.562424;
    w1[3][7] = -1.251736;
    w1[4][7] = 0.653225;
    w1[5][7] = 0.002798;
    w1[6][7] = -1.737760;
    w1[7][7] = 0.959063;
    w1[8][7] = 0.218447;
    w1[9][7] = -1.297327;
    w1[10][7] = 2.105470;
    w1[11][7] = -0.660781;
    w1[12][7] = 1.834122;
    w1[0][8] = 0.803002;
    w1[1][8] = -0.794122;
    w1[2][8] = -0.250683;
    w1[3][8] = -1.697257;
    w1[4][8] = 1.870956;
    w1[5][8] = 0.766344;
    w1[6][8] = -1.404020;
    w1[7][8] = 1.468367;
    w1[8][8] = 1.352709;
    w1[9][8] = 0.379564;
    w1[10][8] = -1.063403;
    w1[11][8] = -1.087350;
    w1[12][8] = 1.426493;
    w1[0][9] = -0.041567;
    w1[1][9] = -1.404601;
    w1[2][9] = 0.125904;
    w1[3][9] = 0.974516;
    w1[4][9] = -0.329735;
    w1[5][9] = -0.807411;
    w1[6][9] = 0.118529;
    w1[7][9] = 0.703582;
    w1[8][9] = 0.936517;
    w1[9][9] = 0.964440;
    w1[10][9] = 0.022546;
    w1[11][9] = -2.940861;
    w1[12][9] = 0.216100;
    w1[0][10] = 1.284482;
    w1[1][10] = -1.946224;
    w1[2][10] = 0.094659;
    w1[3][10] = 0.603372;
    w1[4][10] = -0.300173;
    w1[5][10] = -1.640388;
    w1[6][10] = 1.825672;
    w1[7][10] = 1.804508;
    w1[8][10] = 0.141389;
    w1[9][10] = -0.574011;
    w1[10][10] = -0.068473;
    w1[11][10] = -0.136984;
    w1[12][10] = 1.049673;
    w1[0][11] = -0.693330;
    w1[1][11] = -0.341738;
    w1[2][11] = -0.773389;
    w1[3][11] = 1.927972;
    w1[4][11] = -0.848542;
    w1[5][11] = 0.904250;
    w1[6][11] = 0.016635;
    w1[7][11] = -1.167063;
    w1[8][11] = 0.563989;
    w1[9][11] = 1.166713;
    w1[10][11] = -0.876533;
    w1[11][11] = -3.144084;
    w1[12][11] = 2.034234;
    w1[0][12] = -1.133510;
    w1[1][12] = 2.061330;
    w1[2][12] = 1.183223;
    w1[3][12] = -1.405697;
    w1[4][12] = 0.395607;
    w1[5][12] = -0.771080;
    w1[6][12] = 1.243639;
    w1[7][12] = 0.728168;
    w1[8][12] = 0.561509;
    w1[9][12] = -1.001718;
    w1[10][12] = 1.233409;
    w1[11][12] = -6.007002;
    w1[12][12] = 1.228923;
    w2[0][0] = 3.501605;
    w2[1][0] = -4.368105;
    w2[2][0] = 8.312098;
    w2[3][0] = -1.120274;
    w2[4][0] = -2.188708;
    w2[5][0] = -5.579559;
    w2[6][0] = 4.696012;
    w2[7][0] = 0.752429;
    w2[8][0] = -0.160106;
    w2[9][0] = -2.609308;
    w2[10][0] = 1.104233;
    w2[11][0] = -3.688998;
    w2[12][0] = -5.684107;
    w2[0][1] = -2.579538;
    w2[1][1] = -1.829793;
    w2[2][1] = 0.573429;
    w2[3][1] = 0.513687;
    w2[4][1] = -1.315665;
    w2[5][1] = -2.008880;
    w2[6][1] = -0.363615;
    w2[7][1] = -2.718186;
    w2[8][1] = -2.195517;
    w2[9][1] = -0.401489;
    w2[10][1] = 0.267634;
    w2[11][1] = 0.277088;
    w2[12][1] = -0.031514;

    //-----propagation----------------------------

    FILE *in;

    if ((in = fopen("C:\\Wine\\outputs\\wine.txt", "rt")) == NULL)
    {
        printf("Unable to open file.\n");
        return 1;
    }

    while (!feof(in))
    {
        fscanf(in, "%f;%f;%f;%f;%f;%f;%f;%f;%f;%f;%f", &E1, &E2, &E3, &E4, &E5, &E6, &E7, &E8, &E9, &E10, &E11);

        i++;
    }

    printf("====== ANALISE VINHO VERMELHO ======\n\n");

    printf("\n Acidez fixa -------------- %.2f", E1);
    printf("\n Acidez volatil ----------- %.2f", E2);
    printf("\n Acidez citrica ----------- %.2f", E3);
    printf("\n Acucar resitual ---------- %.2f", E4);
    printf("\n Cloretos ----------------- %.2f", E5);
    printf("\n Dioxido enxofre livre ---- %.2f", E6);
    printf("\n Dioxido enxofre total ---- %.2f", E7);
    printf("\n Densidade ---------------- %.2f", E8);
    printf("\n pH ----------------------- %.2f", E9);
    printf("\n Sulfatos ----------------- %.2f", E10);
    printf("\n Alcool ------------------- %.2f", E11);

    printf("\n\n Pressione a tecla Enter para iniciar a analise... \n\n");

    fclose(in);
    getch();

    E1 = (E1 - 4.6) / 11.3;
    E2 = (E2 - 0.12) / 1.46;
    E3 = (E3 - 0) / 1;
    E4 = (E4 - 0.9) / 14.5;
    E5 = (E5 - 0.01) / 0.6;
    E6 = (E6 - 1) / 71;
    E7 = (E7 - 6) / 159;
    E8 = (E8 - 0.99) / 0.01;
    E9 = (E9 - 2.74) / 1.27;
    E10 = (E10 - 0.33) / 1.67;
    E11 = (E11 - 8.4) / 6.5;
    E12 = (E12 - 3) / 5;

    I[0][0] = E1;
    I[0][1] = E2;
    I[0][2] = E3;
    I[0][3] = E4;
    I[0][4] = E5;
    I[0][5] = E6;
    I[0][6] = E7;
    I[0][7] = E8;
    I[0][8] = E9;
    I[0][9] = E10;
    I[0][10] = E11;
    I[0][11] = E12;
    I[0][12] = 1.0;

    O[0][0] = I[0][0];
    O[0][1] = I[0][1];
    O[0][2] = I[0][2];
    O[0][3] = I[0][3];
    O[0][4] = I[0][4];
    O[0][5] = I[0][5];
    O[0][6] = I[0][6];
    O[0][7] = I[0][7];
    O[0][8] = I[0][8];
    O[0][9] = I[0][9];
    O[0][10] = I[0][10];
    O[0][11] = I[0][11];
    O[0][12] = I[0][12];

    for (j = 0; j < 13; j++)
    {
        I[1][j] = 0.0;
        for (i = 0; i < 13; i++)
        {
            I[1][j] += w1[i][j] * O[0][i];
        }
        O[1][j] = 1.0 / (1.0 + exp(-I[1][j]));
    }

    I[1][3] = 1.0;
    O[1][3] = I[1][3];

    for (l = 0; l < 2; l++)
    {
        I[2][l] = 0.0;
        for (j = 0; j < 13; j++)
        {
            I[2][l] += w2[j][l] * O[1][j];
        }
        O[2][l] = 1.0 / (1.0 + exp(-I[2][l]));
        output = O[2][l];
    }

    FILE *pont_arq;
    pont_arq = fopen("C:\\Wine\\outputs\\quality.txt", "w");

    if (pont_arq == NULL)
    {
        printf("There was an error saving the data..");
        return 1;
    }

    fprintf(pont_arq, "%.2f", output);
    fclose(pont_arq);

    printf("\n\nTraining completed.\n");
    system("pause");
    //-----backpropagation----------------------
}
